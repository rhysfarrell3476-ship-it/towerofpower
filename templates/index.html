<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Tower of Power</title>
  <style>
    html, body {
      height: 100%;
      margin: 0;
    }
    body {
      display: flex;
      font-family: Arial, sans-serif;
    }

    /* Sidebar */
    #sidebar {
      width: 200px;
      background-color: #f0f0f0;
      padding: 10px;
      overflow-y: auto;
    }
    #sidebar ul {
      list-style-type: none;
      padding: 0;
    }
    #sidebar li {
      margin-bottom: 5px;
    }
    #sidebar button.active {
      font-weight: bold;
      background-color: #3498db;
      color: white;
      border: none;
      padding: 5px 10px;
      border-radius: 5px;
      cursor: pointer;
    }

    /* Main game area */
    #main {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      align-items: center;
      padding: 20px;
      overflow: hidden;
    }

    /* Question */
    #question {
      margin-bottom: 20px;
      text-align: center;
    }

    /* Tower as pyramid */
    #tower {
      display: flex;
      flex-direction: column-reverse; /* bottom = rank 1 */
      justify-content: flex-end;
      align-items: center;
      height: 60%;
    }
    .tower-block {
      background-color: #3498db;
      color: white;
      margin: 2px 0;
      text-align: center;
      line-height: 30px;
      border-radius: 5px;
      height: 30px;
    }

    /* Input area */
    #input-area {
      margin-top: 20px;
    }
    #guess {
      padding: 5px;
      width: 150px;
    }

    /* Lives */
    #lives {
      margin-top: 20px;
    }
    .life {
      display: inline-block;
      width: 20px;
      height: 20px;
      background-color: red;
      margin-right: 5px;
      border-radius: 50%;
    }
  </style>
</head>
<body>

  <!-- Sidebar -->
  <div id="sidebar">
    <h3>Categories</h3>
    <ul>
      {% for cat in categories %}
        <li>
          <form method="POST" style="display:inline;">
            <input type="hidden" name="category" value="{{ cat }}">
            <input type="hidden" name="date" value="{{ current_date }}">
            <button type="submit" {% if selected_category == cat %}class="active"{% endif %}>
              {{ cat }}
            </button>
          </form>
        </li>
      {% endfor %}
    </ul>
    <form method="POST">
      <input type="hidden" name="date" value="{{ current_date }}">
      <button type="submit" name="next_day">Next Day</button>
    </form>
  </div>

  <!-- Main area -->
  <div id="main">
    <!-- Question -->
    <div id="question">
      <h2>{{ question_text }}</h2>
    </div>

    <!-- Tower as pyramid -->
    <div id="tower">
      {% for i in range(top_ten|length) %}
        <div class="tower-block" id="block-{{ i }}" style="width: {{ 50 + i*15 }}px;"></div>
      {% endfor %}
    </div>

    <!-- Input -->
    <div id="input-area">
      <input type="text" id="guess" placeholder="Enter your guess">
      <button onclick="submitGuess()">Submit</button>
    </div>

    <!-- Lives -->
    <div id="lives">
      {% for i in range(lives) %}
        <div class="life"></div>
      {% endfor %}
    </div>
  </div>

  <!-- Game JS -->
  <script>
    const answers = {{ top_ten|tojson }};
    let lives = {{ lives }};
    let gameOver = false;

    function submitGuess() {
      if (gameOver) return;

      const guessInput = document.getElementById('guess');
      const guess = guessInput.value.trim();
      guessInput.value = '';

      let correct = false;

      for (let i = 0; i < answers.length; i++) {
        const block = document.getElementById('block-' + i);
        if (block.innerText === '' && answers[i].toLowerCase() === guess.toLowerCase()) {
          block.innerText = answers[i];
          block.style.backgroundColor = '#2ecc71'; // green
          correct = true;
          break;
        }
      }

      if (!correct) {
        lives--;
        updateLives();
        if (lives <= 0) endGame();
      }

      if (document.querySelectorAll('.tower-block:empty').length === 0) endGame();
    }

    function updateLives() {
      const lifeDivs = document.getElementById('lives').children;
      for (let i = 0; i < lifeDivs.length; i++) {
        lifeDivs[i].style.backgroundColor = i < lives ? 'red' : 'grey';
      }
    }

    function endGame() {
      gameOver = true;
      for (let i = 0; i < answers.length; i++) {
        const block = document.getElementById('block-' + i);
        if (block.innerText === '') {
          block.innerText = answers[i];
          block.style.backgroundColor = '#e74c3c'; // red for missed
        }
      }
      document.getElementById('guess').disabled = true;
      alert('Game Over!');
    }

    // Submit on Enter key
    document.getElementById('guess').addEventListener('keyup', function(event) {
      if (event.key === 'Enter') submitGuess();
    });
  </script>

</body>
</html>


